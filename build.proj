<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0" DefaultTargets="build_all">

  <PropertyGroup>
    <CreateModule>../../output/binutils/CreateModule.dll</CreateModule>
    <CreateModuleVersion>../../output/binutils/UpdateModuleVersionOnBuild.dll</CreateModuleVersion>
    <CheckChanges>../../output/binutils/CheckForFileChanges.dll</CheckChanges>
	<Configuration>Release</Configuration>
  </PropertyGroup>

  <Target Name="build_all">
	<Exec Command="dotnet $(CheckChanges) &quot;.&quot;" ConsoleToMsBuild="true">
		  <Output TaskParameter="ConsoleOutput" PropertyName="ShouldBuild" />
	</Exec>	
        <CallTarget Targets="do_build" Condition="$(ShouldBuild.Contains('CHANGES'))" />	
	<Exec Command="dotnet $(CheckChanges) &quot;.&quot;" ConsoleToMsBuild="true"/>
  </Target>
  <Target Name="do_build">
	<RemoveDir Directories="../../output/modules/OpenAI.Clients"/>
	<Exec Command="dotnet publish ./Decisions.OpenAI/Decisions.OpenAI.csproj --runtime $(Runtime) --self-contained false --output ./Decisions.OpenAI/bin -c $(Configuration)" />
	<CallTarget Targets="build_module"/>	
  </Target>

  <Target Name="build_module">
	<Exec Command="dotnet $(CreateModuleVersion) &quot;../../Build.version&quot; &quot;Module.Build.xml&quot; &quot;Module.Build.versioned.xml&quot; &quot;../../Version.cs&quot; false &quot;Decisions.OpenAI&quot; &quot;../AllModules.xml&quot;"/>
	<Exec Command="dotnet $(CreateModule) -buildmodule Decisions.OpenAI -output &quot;../../output/modules&quot; -buildfile Module.Build.versioned.xml"/>
  </Target>

</Project>
